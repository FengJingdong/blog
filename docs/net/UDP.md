# UDP

## UDP协议简介
UDP（用户数据报协议）：是OSI参考模型中的一种无连接传输层协议，提供面向事务的简单不可靠信息传输服务。
特点：
- （1）udp是无连接的 即发送数据报无需建立连接，并因此减少了开销和发送数据之前不必要的时延；
- （2）使用尽量大努力交付；
- （3）是面向报文的

## 为什么不直接使用IP协议而要额外增加一个UDP协议呢？

一个重要的原因是IP协议中并没有端口(port)的概念。IP协议进行的是IP地址到IP地址的传输，这意味者两台计算机之间的对话。但每台计算机中需要有多个通信通道，并将多个通信通道分配给不同的进程使用(关于进程，可以参考Linux进程基础)。一个端口就代表了这样的一个通信通道。正如我们在邮局和邮差中提到的收信人的概念一样。UDP协议实现了端口，从而让数据包可以在送到IP地址的基础上，进一步可以送到某个端口。

## UDP（User Data Protocol，用户数据报协议）

- （1） UDP是一个非连接的协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制；在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。
- （2） 由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。
- （3） UDP信息包的标题很短，只有8个字节，相对于TCP的20个字节信息包的额外开销很小。
- （4） 吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制。
- （5）UDP使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态表（这里面有许多参数）。
- （6）UDP是面向报文的。发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付给IP层。既不拆分，也不合并，而是保留这些报文的边界，因此，应用程序需要选择合适的报文大小。

我们经常使用“ping”命令来测试两台主机之间TCP/IP通信是否正常，其实“ping”命令的原理就是向对方主机发送UDP数据包，然后对方主机确认收到数据包，如果数据包是否到达的消息及时反馈回来，那么网络就是通的。

- UDP的包头结构：
    - 源端口 16位
    - 目的端口 16位
    - 长度 16位
    - 校验和 16位

## 场景

网络直播采用的很多协议都是基于UDP的，为什么呢？在网络直播的业务中，是允许部分丢包的，即便我们丢失了部分帧，也能够正常的播放，并且用户不一定感受得到。

TCP是不允许丢包的，TCP协议会有复杂的重试机制，特别是在弱网环境下，一旦有数据发送失败，TCP协议就会不停地重试，导致新的视频内容没办法刷出来，那样子视频反而会一卡一顿。同样，在我们经常玩的MOBA游戏中，例如王者荣耀或者英雄联盟，一旦包丢失了，重新获取到几秒钟前的包已经意义不大了。

>特点

UDP的数据包并没有序列，所以，UDP不保证消息交付顺序，并且不确认，不重传，不排重，随心所欲，有包就发，不像TCP会优先发队首。UDP不跟踪连接状态，不建立连接也不关心对方是否能收到！UDP不需要流量控制，不管网络的情况，没有拥塞控制。